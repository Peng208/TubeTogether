"use strict";var _slicedToArray=function(){function t(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(s){i=!0,a=s}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.YT2gether={stopInit:!1,event:"postCSS",startAt:null},YT2gether.countdownTimer=function(){var t=new Date(YT2gether.startAt)-new Date,e=void 0,r=function n(){var r=void 0;t=(new Date(YT2gether.startAt)-new Date)/1e3,clearTimeout(YT2gether.refeshTimer),e.roughTime=null,e.time=e.timeBase.map(function(r,n){return t/r%e.timeLimitation[n]|0}),e.time.forEach(function(t,n){!e.roughTime&&t&&(r=e.timeBase[n],e.roughTime=t+e.timeUnit[n])}),document.documentElement.setAttribute("data-countdown","Start after ~"+e.roughTime),60>t?YT2gether.refeshTimer=setTimeout(function(){document.documentElement.setAttribute("data-countdown","Start!"),YT2gether.initYoutube()},1e3*t):YT2gether.refeshTimer=setTimeout(function(){n()},200*r)};t>0&&(e={timeUnit:"dhms",timeBase:[86400,3600,60,1],timeLimitation:[3650,24,60,60]},r())},YT2gether.generator=function(){var t={el:{},data:{base:location.origin+location.pathname}},e={YMDTHM:/^\d{4}(-\d{2}){2}T\d{2}:\d{2}/,THMS:/T\d{2}:\d{2}:\d{2}$/};t.el.form=document.getElementsByClassName("dialog")[0];var r=[].slice.call(t.el.form.getElementsByTagName("input")),n=_slicedToArray(r,3);t.el.time=n[0],t.el.listid=n[1],t.el.chatroom=n[2],t.el.resultLink=t.el.form.querySelector(".result a");var i=[].slice.call(t.el.form.querySelectorAll(".sharebtn")),a=_slicedToArray(i,2);t.el.shareBtnFB=a[0],t.el.shareBtnTwitter=a[1],t.data.urlTpl={fb:t.el.shareBtnFB.getAttribute("data-url"),tw:t.el.shareBtnTwitter.getAttribute("data-url")},t.updateLink=function(){if(!t.el.form.checkValidity())return void console.log("form checkValidity false!");var r=t.el.time.value;e.YMDTHM.test(r)&&(t.data.time=r+=e.THMS.test(r)?"+08:00":":00+08:00"),t.data.listid=t.el.listid.value,t.data.chatroom=""===t.el.chatroom.value?"":"&chatroom="+t.el.chatroom.value;var n=t.data.base+("?startAt="+t.data.time+"&list="+t.data.listid+t.data.chatroom);t.el.resultLink.innerHTML=n,t.el.resultLink.href=n,t.el.shareBtnFB.href=t.data.urlTpl.fb.replace("${url}",encodeURI(n)),t.el.shareBtnTwitter.href=t.data.urlTpl.tw.replace("${url}",encodeURIComponent(n)).replace("${text}",t.data.time)};var o=new Date;t.el.time.value=new Date(o-6e4*o.getTimezoneOffset()).toISOString().split(".")[0],t.updateLink(),t.el.form.addEventListener("input",t.updateLink),t.el.form.style.display="block"},location.search.length?!function(){var t=location.search.substr(1),e={};t.split(/&/).forEach(function(t){e[t.split(/=/)[0]]=t.split(/=/)[1]||""}),YT2gether.startAt=e.startAt,YT2gether.listId=e.list,YT2gether["new"]=""===e["new"],YT2gether.chatroom=e.chatroom||"https://gitter.im/f2etw/TubeTogether/~chat",YT2gether["new"]?(YT2gether.stopInit=!0,YT2gether.generator()):YT2gether.startAt&&YT2gether.listId?YT2gether.countdownTimer():(YT2gether.stopInit=!0,location.href=location.origin+location.pathname)}():(YT2gether.stopInit=!0,fetch("https://api.github.com/repos/f2etw/TubeTogether/issues?labels=living&state=open").then(function(t){return t.json()}).then(function(t){/^\?/.test(t[0].body)&&(location.search=t[0].body.match(/^\?.+/)[0])})["catch"](function(t){return window.confirm("GG 惹，請問要去 GitHub issue 確認一下有沒有新活動嗎？")&&(location.href="https://github.com/f2etw/TubeTogether/labels/living"),"GG"}));var API_KEY="AIzaSyDyZ231vqsztOc_f2rKwyedUOY9eEnq2lU",YOUTUBE_API_URL="https://www.googleapis.com/youtube/v3",DURATION_UNIT={H:3600,M:60,S:1};YT2gether.initChatroom=function(){if(!YT2gether.stopInit&&"none"!==YT2gether.chatroom){var t=document.createElement("iframe");t.src=YT2gether.chatroom,document.body.appendChild(t)}},YT2gether.initYoutube=function(){YT2gether.stopInit||fetch(YOUTUBE_API_URL+"/playlistItems?part=contentDetails&maxResults=50&playlistId="+YT2gether.listId+"&key="+API_KEY).then(function(t){return t.json()}).then(function(t){return t.items.map(function(t){return t.contentDetails.videoId}).join()}).then(function(t){return fetch(YOUTUBE_API_URL+"/videos?part=contentDetails&maxResults=50&id="+t+"&key="+API_KEY).then(function(t){return t.json()})}).then(function(t){var e=t.items.map(function(t){return t.contentDetails.duration.match(/\d+\w/gi).map(function(t){var e=t.match(/(\d+)(\w)/),r=_slicedToArray(e,3),n=r[1],i=r[2];return n*DURATION_UNIT[i]}).reduce(function(t,e){return t+e})}),r=0,n=e.map(function(t){return r+=t}),i=n.slice(-1)[0],a={};if(a.deltaTime=(new Date-new Date(YT2gether.startAt))/1e3|0,!(a.deltaTime<0||i<a.deltaTime)){for(var o=n.length-1;o>=0;o--)if(a.deltaTime>n[o]){a.startTime=a.deltaTime-n[o];break}YT2gether.player=new YT.Player("player",{playerVars:{listType:"playlist",list:YT2gether.listId,autoplay:1,start:a.startTime,state:1,index:o}})}})},YT2gether.initChatroom(),YT2gether.initYoutube();
//# sourceMappingURL=app.js.map
