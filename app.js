"use strict";var _slicedToArray=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.YT2gether={stopInit:!1,event:"postCSS",startAt:null},location.search.length?!function(){var t=location.search.substr(1),e={};t.split(/&/).forEach(function(t){e[t.split(/=/)[0]]=t.split(/=/)[1]||""}),YT2gether.startAt=e.startAt,YT2gether.listId=e.list,YT2gether.chatroom=e.chatroom||"https://gitter.im/f2etw/TubeTogether/~chat";var r=new Date(YT2gether.startAt)-new Date,n=void 0,i=function o(){var t=void 0;r=(new Date(YT2gether.startAt)-new Date)/1e3,clearTimeout(YT2gether.refeshTimer),n.roughTime=null,n.time=n.timeBase.map(function(t,e){return r/t%n.timeLimitation[e]|0}),n.time.forEach(function(e,r){!n.roughTime&&e&&(t=n.timeBase[r],n.roughTime=e+n.timeUnit[r])}),document.documentElement.setAttribute("data-countdown","Start after ~"+n.roughTime),60>r?YT2gether.refeshTimer=setTimeout(function(){location.reload()},1e3*r):YT2gether.refeshTimer=setTimeout(function(){o()},200*t)};r>0&&(n={timeUnit:"dhms",timeBase:[86400,3600,60,1],timeLimitation:[3650,24,60,60]},i())}():(YT2gether.stopInit=!0,fetch("https://api.github.com/repos/f2etw/TubeTogether/issues?labels=living&state=open").then(function(t){return t.json()}).then(function(t){/^\?/.test(t[0].body)&&(location.search=t[0].body.match(/^\?.+/)[0])})["catch"](function(t){return window.confirm("GG 惹，請問要去 GitHub issue 確認一下有沒有新活動嗎？")&&(location.href="https://github.com/f2etw/TubeTogether/labels/living"),"GG"}));var API_KEY="AIzaSyDyZ231vqsztOc_f2rKwyedUOY9eEnq2lU",YOUTUBE_API_URL="https://www.googleapis.com/youtube/v3",DURATION_UNIT={H:3600,M:60,S:1};YT2gether.initChatroom=function(){if(!YT2gether.stopInit&&"none"!==YT2gether.chatroom){var t=document.createElement("iframe");t.src=YT2gether.chatroom,document.body.appendChild(t)}},YT2gether.initYoutube=function(){YT2gether.stopInit||fetch(YOUTUBE_API_URL+"/playlistItems?part=contentDetails&maxResults=50&playlistId="+YT2gether.listId+"&key="+API_KEY).then(function(t){return t.json()}).then(function(t){return t.items.map(function(t){return t.contentDetails.videoId}).join()}).then(function(t){return fetch(YOUTUBE_API_URL+"/videos?part=contentDetails&maxResults=50&id="+t+"&key="+API_KEY).then(function(t){return t.json()})}).then(function(t){var e=t.items.map(function(t){return t.contentDetails.duration.match(/\d+\w/gi).map(function(t){var e=t.match(/(\d+)(\w)/),r=_slicedToArray(e,3),n=r[1],i=r[2];return n*DURATION_UNIT[i]}).reduce(function(t,e){return t+e})}),r=0,n=e.map(function(t){return r+=t}),i=n.slice(-1)[0],o={};if(o.deltaTime=(new Date-new Date(YT2gether.startAt))/1e3|0,!(o.deltaTime<0||i<o.deltaTime)){for(var a=n.length-1;a>=0;a--)if(o.deltaTime>n[a]){o.startTime=o.deltaTime-n[a];break}YT2gether.player=new YT.Player("player",{playerVars:{listType:"playlist",list:YT2gether.listId,autoplay:1,start:o.startTime,state:1,index:a}})}})},YT2gether.initChatroom(),YT2gether.initYoutube();
//# sourceMappingURL=app.js.map
